version: '2.1'

services:
    
    rt1:
        image: baseimage:tema1
        volumes:
            - .:/elocal
        tty: true
        networks:
            - tnet2
        command: bash -c "tcpdump -nSt icmp"
    
    rt2:
        image: baseimage:tema1
        volumes:
            - .:/elocal
        tty: true
        networks:
            - tnet2
        command: bash -c "ping -s 4000 rt1"
        depends_on: 
            - rt1
    
    rt3:
        image: baseimage:tema1
        volumes:
            - .:/elocal
        tty: true
        networks:
            - tnet2
        sysctls:
          - tnet2.ipv4.icmp_echo_ignore_all=1
        command: bash -c "ping rt1"
    
    rt4:
        image: baseimage:tema1
        volumes:
            - .:/elocal
        tty: true
        networks:
            - tnet2
        command: bash -c "ping -c 1 rt3"
     
    tn1:
         image: baseimage:tema1
         volumes:
             - .:/elocal
         tty: true
         networks:
             - tnet1
         command: bash -c 'echo \"- interfetele de retea:\" && ip addr && echo \"- gateway:\" && ip route show'"

networks:
    tnet2:
    {    
       ipam:
             driver: default
             config:
                   - subnet: 1.2.3.0/16
                     gateway 1.2.3.4
    }  
    tnet1:
    {  
       ipam:
             driver: default
                        - subnet: 11.121.232.0/8
gateway 11.121.232.0
}
